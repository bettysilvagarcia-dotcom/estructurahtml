<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Ejercicio: Arrastrar y soltar estructura HTML</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --fondo: #0f172a; /* slate-900 */
        --panel: #111827; /* gray-900 */
        --borde: #1f2937; /* gray-800 */
        --texto: #e5e7eb; /* gray-200 */
        --acento: #22c55e; /* green-500 */
        --error: #ef4444; /* red-500 */
        --amarillo: #f59e0b; /* amber-500 */
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Ubuntu;
        background: linear-gradient(180deg, #0b1224 0%, #0f172a 100%);
        color: var(--texto);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
      }
      .contenedor {
        width: min(1100px, 95vw);
        display: grid;
        gap: 16px;
        grid-template-columns: 1fr 1.2fr;
      }
      header.app {
        grid-column: 1/-1;
        background: var(--panel);
        border: 1px solid var(--borde);
        padding: 16px 20px;
        border-radius: 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);
      }
      header.app h1 {
        font-size: 1.1rem;
        margin: 0;
        letter-spacing: 0.2px;
      }
      header.app .acciones {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      button {
        background: #1f2937;
        color: var(--texto);
        border: 1px solid var(--borde);
        padding: 10px 14px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        transition: 0.15s transform ease, 0.15s background ease,
          0.15s border-color ease;
      }
      button:hover {
        transform: translateY(-1px);
        background: #273245;
      }
      button.verde {
        border-color: #065f46;
        background: #064e3b;
      }
      button.verde:hover {
        background: #046647;
      }
      button.amarillo {
        border-color: #78350f;
        background: #451a03;
      }
      button.amarillo:hover {
        background: #6b2d04;
      }
      .col {
        background: var(--panel);
        border: 1px solid var(--borde);
        border-radius: 16px;
        padding: 16px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);
      }
      .col h2 {
        margin: 0 0 10px 0;
        font-size: 1rem;
        opacity: 0.95;
      }
      .piezas {
        display: grid;
        gap: 10px;
        grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
        min-height: 200px;
      }
      .pieza {
        background: #164594;
        border: 1px solid #1b2a43;
        padding: 5px 6px;
        border-radius: 12px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas,
          "Liberation Mono", monospace;
        font-size: 0.92rem;
        cursor: grab;
        user-select: none;
        white-space: pre;
        line-height: 1.3;
      }
      .pieza:active {
        cursor: grabbing;
      }
      .pieza[data-arrastrable="false"] {
        opacity: 0.55;
        cursor: not-allowed;
      }
      .objetivo {
        background: #0a1322;
        border: 1px dashed #2a3b5f;
        border-radius: 14px;
        padding: 12px;
        min-height: 320px;
      }
      .lista-objetivo {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .slot {
        background: #091120;
        border: 1px solid #1d2a48;
        padding: 10px;
        border-radius: 12px;
        min-height: 46px;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: 0.12s border-color ease, 0.12s background ease;
      }
      .slot.vacia {
        opacity: 0.75;
      }
      .slot .etiqueta {
        font-size: 0.8rem;
        opacity: 0.75;
      }
      .slot.resaltado {
        border-color: #325fbc;
        background: #0f1b35;
      }
      .slot.correcto {
        border-color: #065f46;
        background: rgba(34, 197, 94, 0.08);
      }
      .slot.incorrecto {
        border-color: #7f1d1d;
        background: rgba(239, 68, 68, 0.08);
      }
      .nota {
        margin-top: 10px;
        font-size: 0.9rem;
        opacity: 0.9;
      }
      .estado {
        margin-left: 12px;
        font-weight: 700;
        font-variant-numeric: tabular-nums;
      }
      .estado.ok {
        color: var(--acento);
      }
      .estado.err {
        color: var(--error);
      }
      .leyenda {
        font-size: 0.85rem;
        opacity: 0.85;
        margin-top: 6px;
      }
      .codigo-preview {
        background: #0b1222;
        border: 1px solid #1e2a45;
        border-radius: 12px;
        padding: 12px;
        margin-top: 12px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas,
          "Liberation Mono", monospace;
        font-size: 0.9rem;
        white-space: pre;
        overflow: auto;
        max-height: 280px;
      }
      @media (max-width: 900px) {
        .contenedor {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="contenedor">
      <header class="app">
        <h1>
          Arrastra las piezas para construir un documento <code>HTML</code> con
          <code>&lt;header&gt;</code>, <code>&lt;section&gt;</code> y
          <code>&lt;footer&gt;</code>.
        </h1>
        <div class="acciones">
          <button id="btnMezclar" title="Mezclar piezas">Mezclar</button>
          <button id="btnPista" class="amarillo" title="Resaltar errores">
            Pista
          </button>
          <button id="btnVerificar" class="verde" title="Comprobar solución">
            Verificar
          </button>
          <button id="btnReiniciar" title="Volver a empezar">Reiniciar</button>
          <span id="txtEstado" class="estado"></span>
        </div>
      </header>

      <!-- Banco de piezas -->
      <section class="col">
        <h2>Banco de piezas</h2>
        <div
          id="contenedorPiezas"
          class="piezas"
          aria-label="Piezas disponibles"
        ></div>
        <p class="leyenda">
          Arrastra cada pieza hacia un <strong>slot</strong> del objetivo.
          Puedes volver a arrastrarlas para reacomodar.
        </p>
      </section>

      <!-- Objetivo a completar -->
      <section class="col">
        <h2>Documento objetivo</h2>
        <div class="objetivo">
          <ol
            id="listaObjetivo"
            class="lista-objetivo"
            role="list"
            aria-label="Orden objetivo"
          >
            <!-- Los slots se generan por JS según la respuesta correcta -->
          </ol>
        </div>
        <div id="vistaPrevia" class="codigo-preview" aria-live="polite"></div>
        <div class="nota">
          Consejo: la estructura correcta debe abrir y cerrar etiquetas en
          orden, y el <code>&lt;header&gt;</code>,
          <code>&lt;section&gt;</code> y <code>&lt;footer&gt;</code> van dentro
          de <code>&lt;body&gt;</code>.
        </div>
      </section>
    </div>

    <script>
      /* ============================
       Variables en español
    ============================ */
      const piezasIniciales = [
        "<!DOCTYPE html>",
        '<html lang="es">',
        "  <head>",
        '    <meta charset="utf-8">',
        "    <title>Mi página</title>",
        "  </head>",
        "  <body>",
        "    <header>\n      <h1>Encabezado del sitio</h1>\n    </header>",
        "    <section>\n      <p>Contenido principal.</p>\n    </section>",
        "    <footer>\n      <small>© 2025</small>\n    </footer>",
        "  </body>",
        "</html>",
      ];

      // Respuesta correcta en orden (índices respecto a piezasIniciales)
      const respuestaCorrecta = [...piezasIniciales.keys()];

      // Estado global
      let piezas = []; // objetos { id, texto }
      let mapaSlotAPieza = new Map(); // slotIndex -> piezaId (o null)
      let arrastradoId = null; // id de pieza que se arrastra
      let puntaje = 0;

      // Elementos del DOM
      const contenedorPiezas = document.getElementById("contenedorPiezas");
      const listaObjetivo = document.getElementById("listaObjetivo");
      const vistaPrevia = document.getElementById("vistaPrevia");
      const txtEstado = document.getElementById("txtEstado");
      const btnMezclar = document.getElementById("btnMezclar");
      const btnPista = document.getElementById("btnPista");
      const btnVerificar = document.getElementById("btnVerificar");
      const btnReiniciar = document.getElementById("btnReiniciar");

      /* ============================
       Utilidades
    ============================ */
      const crearId = (() => {
        let contador = 0;
        return () => `pieza_${++contador}`;
      })();

      function mezclarArreglo(arreglo) {
        // Fisher-Yates
        for (let i = arreglo.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arreglo[i], arreglo[j]] = [arreglo[j], arreglo[i]];
        }
        return arreglo;
      }

      function limpiarNodo(nodo) {
        while (nodo.firstChild) nodo.removeChild(nodo.firstChild);
      }

      function actualizarVistaPrevia() {
        const lineas = [];
        for (let i = 0; i < respuestaCorrecta.length; i++) {
          const piezaId = mapaSlotAPieza.get(i);
          if (piezaId) {
            const p = piezas.find((x) => x.id === piezaId);
            lineas.push(p.texto);
          } else {
            lineas.push("/* ... */");
          }
        }
        vistaPrevia.textContent = lineas.join("\n");
      }

      function actualizarEstado(mensaje, tipo = "") {
        txtEstado.textContent = mensaje;
        txtEstado.classList.toggle("ok", tipo === "ok");
        txtEstado.classList.toggle("err", tipo === "err");
      }

      /* ============================
       Creación de UI
    ============================ */
      function crearPiezaDOM(objPieza) {
        const div = document.createElement("div");
        div.className = "pieza";
        div.setAttribute("draggable", "true");
        div.dataset.id = objPieza.id;
        div.textContent = objPieza.texto;

        div.addEventListener("dragstart", (ev) => {
          arrastradoId = objPieza.id;
          ev.dataTransfer.setData("text/plain", objPieza.id);
          ev.dataTransfer.effectAllowed = "move";
        });

        div.addEventListener("dragend", () => {
          arrastradoId = null;
        });

        return div;
      }

      function crearSlotDOM(indice) {
        const li = document.createElement("li");
        li.className = "slot vacia";
        li.dataset.indice = String(indice);

        const etiqueta = document.createElement("span");
        etiqueta.className = "etiqueta";
        etiqueta.textContent = `Slot ${indice + 1}`;
        li.appendChild(etiqueta);

        // Drop habilitado
        li.addEventListener("dragover", (ev) => {
          ev.preventDefault();
          li.classList.add("resaltado");
          ev.dataTransfer.dropEffect = "move";
        });

        li.addEventListener("dragleave", () =>
          li.classList.remove("resaltado")
        );

        li.addEventListener("drop", (ev) => {
          ev.preventDefault();
          li.classList.remove("resaltado");
          const piezaId = ev.dataTransfer.getData("text/plain") || arrastradoId;
          if (!piezaId) return;

          colocarPiezaEnSlot(piezaId, indice);
        });

        // Permite re-arrastrar desde el slot de vuelta al banco
        li.addEventListener("click", () => {
          const piezaId = mapaSlotAPieza.get(indice);
          if (piezaId) {
            devolverPiezaAlBanco(piezaId);
            mapaSlotAPieza.set(indice, null);
            marcarSlot(li, "neutral");
            actualizarVistaPrevia();
          }
        });

        return li;
      }

      /* ============================
       Lógica de arrastrar/soltar
    ============================ */
      function colocarPiezaEnSlot(piezaId, indiceSlot) {
        // Si ya estaba en algún slot, liberarlo
        for (const [i, id] of mapaSlotAPieza.entries()) {
          if (id === piezaId) {
            mapaSlotAPieza.set(i, null);
            const slotPrevio = listaObjetivo.children[i];
            if (slotPrevio) marcarSlot(slotPrevio, "neutral");
          }
        }

        // Quitar del banco visual
        const nodo = contenedorPiezas.querySelector(
          `.pieza[data-id="${piezaId}"]`
        );
        if (nodo) contenedorPiezas.removeChild(nodo);

        // Colocar visualmente dentro del slot
        const slot = listaObjetivo.children[indiceSlot];
        const etiqueta = slot.querySelector(".etiqueta");
        if (etiqueta) etiqueta.remove();

        const piezaActual = piezas.find((x) => x.id === piezaId);
        const clon = crearPiezaDOM(piezaActual);
        clon.setAttribute("draggable", "true");

        // Permitimos sacar la pieza del slot al banco con doble click
        clon.addEventListener("dblclick", () => {
          devolverPiezaAlBanco(piezaId);
          mapaSlotAPieza.set(indiceSlot, null);
          marcarSlot(slot, "neutral");
          actualizarVistaPrevia();
        });

        // Si el slot ya tenía pieza, devolverla al banco
        const anteriorId = mapaSlotAPieza.get(indiceSlot);
        if (anteriorId) {
          devolverPiezaAlBanco(anteriorId);
        }

        slot.innerHTML = "";
        slot.appendChild(clon);
        slot.classList.remove("vacia");
        mapaSlotAPieza.set(indiceSlot, piezaId);

        actualizarVistaPrevia();
        actualizarEstado("", "");
      }

      function devolverPiezaAlBanco(piezaId) {
        const pieza = piezas.find((x) => x.id === piezaId);
        if (!pieza) return;
        const div = crearPiezaDOM(pieza);
        contenedorPiezas.appendChild(div);
      }

      function marcarSlot(slot, tipo) {
        slot.classList.remove("resaltado", "correcto", "incorrecto");
        if (tipo === "ok") slot.classList.add("correcto");
        else if (tipo === "bad") slot.classList.add("incorrecto");
        // Si no hay pieza visible, mostrar estilo "vacía"
        if (!slot.querySelector(".pieza")) {
          slot.classList.add("vacia");
          if (!slot.querySelector(".etiqueta")) {
            const etiqueta = document.createElement("span");
            etiqueta.className = "etiqueta";
            etiqueta.textContent = `Slot ${Number(slot.dataset.indice) + 1}`;
            slot.prepend(etiqueta);
          }
        } else {
          slot.classList.remove("vacia");
        }
      }

      /* ============================
       Verificación y pista
    ============================ */
      function verificarSolucion() {
        let correctas = 0;
        for (let i = 0; i < respuestaCorrecta.length; i++) {
          const slot = listaObjetivo.children[i];
          const piezaId = mapaSlotAPieza.get(i);
          if (!piezaId) {
            marcarSlot(slot, "bad");
            continue;
          }
          const pieza = piezas.find((p) => p.id === piezaId);
          const textoEsperado = piezasIniciales[respuestaCorrecta[i]];
          if (pieza.texto.trim() === textoEsperado.trim()) {
            marcarSlot(slot, "ok");
            correctas++;
          } else {
            marcarSlot(slot, "bad");
          }
        }
        puntaje = Math.round((100 * correctas) / respuestaCorrecta.length);
        const completo = correctas === respuestaCorrecta.length;
        actualizarEstado(
          completo
            ? `¡Perfecto! 100/100 ✔`
            : `Aciertos: ${correctas}/${respuestaCorrecta.length} — Puntaje: ${puntaje}`,
          completo ? "ok" : "err"
        );
      }

      function mostrarPista() {
        for (let i = 0; i < respuestaCorrecta.length; i++) {
          const slot = listaObjetivo.children[i];
          const piezaId = mapaSlotAPieza.get(i);
          if (!piezaId) {
            marcarSlot(slot, "bad");
            continue;
          }
          const pieza = piezas.find((p) => p.id === piezaId);
          const textoEsperado = piezasIniciales[respuestaCorrecta[i]].trim();
          const esCorrecta = pieza.texto.trim() === textoEsperado;
          marcarSlot(slot, esCorrecta ? "ok" : "bad");
        }
        actualizarEstado(
          "Se han resaltado los aciertos (verde) y errores (rojo).",
          "err"
        );
      }

      /* ============================
       Inicialización / reinicio
    ============================ */
      function inicializar() {
        // Crear objetos de piezas
        piezas = piezasIniciales.map((texto) => ({ id: crearId(), texto }));
        // Mezclar para el banco
        const piezasMezcladas = mezclarArreglo([...piezas]);
        limpiarNodo(contenedorPiezas);
        piezasMezcladas.forEach((p) =>
          contenedorPiezas.appendChild(crearPiezaDOM(p))
        );

        // Crear slots
        limpiarNodo(listaObjetivo);
        mapaSlotAPieza = new Map();
        for (let i = 0; i < respuestaCorrecta.length; i++) {
          const slot = crearSlotDOM(i);
          listaObjetivo.appendChild(slot);
          mapaSlotAPieza.set(i, null);
        }

        actualizarVistaPrevia();
        actualizarEstado("Arrastra las piezas a los slots en orden.", "");
      }

      function reiniciar() {
        inicializar();
      }

      function mezclarBanco() {
        const actuales = Array.from(
          contenedorPiezas.querySelectorAll(".pieza")
        ).map((n) => {
          const id = n.dataset.id;
          return piezas.find((p) => p.id === id);
        });
        // Añadir también las que están en slots (las devolvemos antes de mezclar)
        for (const [i, piezaId] of mapaSlotAPieza.entries()) {
          if (piezaId) {
            devolverPiezaAlBanco(piezaId);
            mapaSlotAPieza.set(i, null);
            const slot = listaObjetivo.children[i];
            marcarSlot(slot, "neutral");
            slot.innerHTML = "";
            const etiqueta = document.createElement("span");
            etiqueta.className = "etiqueta";
            etiqueta.textContent = `Slot ${i + 1}`;
            slot.appendChild(etiqueta);
          }
        }

        // Mezclar visualmente
        const todas = Array.from(
          contenedorPiezas.querySelectorAll(".pieza")
        ).map((n) => {
          const id = n.dataset.id;
          return piezas.find((p) => p.id === id);
        });
        limpiarNodo(contenedorPiezas);
        mezclarArreglo(todas).forEach((p) =>
          contenedorPiezas.appendChild(crearPiezaDOM(p))
        );
        actualizarVistaPrevia();
        actualizarEstado("Piezas mezcladas.", "");
      }

      /* ============================
       Eventos de UI
    ============================ */
      btnVerificar.addEventListener("click", verificarSolucion);
      btnPista.addEventListener("click", mostrarPista);
      btnReiniciar.addEventListener("click", reiniciar);
      btnMezclar.addEventListener("click", mezclarBanco);

      // Arranque
      inicializar();
    </script>
  </body>
</html>
